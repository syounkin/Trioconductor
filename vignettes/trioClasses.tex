% Sweave(file = "./trioClasses.Rnw")
\documentclass[10pt]{article}

\usepackage{fullpage}
\usepackage{times}
\usepackage[colorlinks=TRUE,urlcolor=blue,citecolor=blue]{hyperref}
\title{\emph{trioClasses} class \emph{gTrio}: A Derivative of \emph{TrioSet} for use with genotype data}
%\author{Sam}
\date{\today}
%\input{/home/bst/student/syounkin/jhsph/latex/sgy}
%\input{/home/sgy/jhsph/latex/sgy}
\usepackage{Sweave}
\begin{document}
\setlength{\parskip}{0.2\baselineskip}
\setlength{\parindent}{0pt}
\maketitle
I found it difficult to construct an extension of \emph{gSet} that was flexible with the AssayData, e.g., geno, lrr and baf.  I think it makes sense to begin with the individual class scheme, and to strip the \emph{TrioSet} class down to bare-bones so we can build it up into something that suits our present needs.  Ultimately, I think a one class scheme is best, but I think it will be challenging to implement.
%<<cachedir, echo=FALSE>>=
%setCacheDir( path = './cache/' )
%@
\begin{Schunk}
\begin{Sinput}
> rm(list = ls())
> library("trioClasses")
> library("trio")
\end{Sinput}
\end{Schunk}
First we load the sample pedigree data frame included in local versions of the trioClasses package.
\begin{Schunk}
\begin{Sinput}
> data(ped)
> head(ped.df)
\end{Sinput}
\begin{Soutput}
             id     mid     fid  Population     PI Ethnicity
578_01   578_01  578_03  578_02 PHILIPPINES Murray  filipino
578_02   578_02    <NA>    <NA> PHILIPPINES Murray  filipino
578_03   578_03    <NA>    <NA> PHILIPPINES Murray  filipino
1539_01 1539_01 1539_03 1539_02        IOWA Murray  european
1539_02 1539_02    <NA>    <NA>        IOWA Murray  european
1539_03 1539_03    <NA>    <NA>        IOWA Murray  european
\end{Soutput}
\begin{Sinput}
> pedigreeInfo <- within(ped.df, {
     F <- as.character(fid)
     M <- as.character(mid)
     O <- as.character(id)
 })
> tg.ped <- Pedigree(pedigreeInfo = pedigreeInfo)
> tg.ped
\end{Sinput}
\begin{Soutput}
This pedigree object contains 1812 complete trios.
For access to the data frame use the trios() accessor function.
\end{Soutput}
\end{Schunk}
After we ensure that F, M and O exist in the data frame we create a Pedigree object.  Note the terse show method for the Pedigree object.
\section{\emph{gTrio} class}
Next we load the genotype matrix with well-named rows and columns, with rows for subjects and columns for SNPs.
\begin{Schunk}
\begin{Sinput}
> data(geno)
> head(geno.mat[, 1:6])
\end{Sinput}
\begin{Soutput}
        snp1 snp2 snp3 snp4 snp5 snp6
578_01     2    2    0    2    2    1
578_02     1    0    1    0    2    2
578_03     0    2    2    0    2    2
1539_01    2    0    2    2    2    0
1539_02    1    1    2    0    1    0
1539_03    1    0    2    2    0    2
\end{Soutput}
\end{Schunk}
Now we format the genotype matrix for input into gTrio() and use the copleteTrios method to remove trios that do not have genotype information for all members.
\begin{Schunk}
\begin{Sinput}
> geno.trio <- genoMat(tg.ped, geno.mat)
> (tg.ped.comp <- completeTrios(tg.ped, colnames(geno.trio)))
\end{Sinput}
\begin{Soutput}
This pedigree object contains 33 complete trios.
For access to the data frame use the trios() accessor function.
\end{Soutput}
\end{Schunk}
Now we create the gTrio object from a complete pedigree and properly formatted, well-named, genotype matrix.
\begin{Schunk}
\begin{Sinput}
> (gTrio.obj <- gTrio(tg.ped.comp, geno = geno.trio))
\end{Sinput}
\begin{Soutput}
gTrio (storageMode: lockedEnvironment)
assayData: 10 features, 33 samples 
  element names: geno 
protocolData: none
phenoData: none
featureData
  featureNames: snp1 snp2 ... snp10 (10 total)
  fvarLabels: position chromosome isSnp
  fvarMetadata: labelDescription
experimentData: use 'experimentData(object)'
Annotation:  
genome:  hg19 
\end{Soutput}
\begin{Sinput}
> class(gTrio.obj)
\end{Sinput}
\begin{Soutput}
[1] "gTrio"
attr(,"package")
[1] "trioClasses"
\end{Soutput}
\end{Schunk}
Now we use the getGeno method to retrieve a genotype matrix formatted, in this case, for use in Holger's trio package.
\begin{Schunk}
\begin{Sinput}
> geno <- getGeno(gTrio.obj, type = "holger")
> dim(geno)
\end{Sinput}
\begin{Soutput}
[1] 99 10
\end{Soutput}
\begin{Sinput}
> (aTDT <- allelicTDT(mat.snp = geno, size = 10000))
\end{Sinput}
\begin{Soutput}
      Allelic TDT

Top 5 SNPs:
      Statistic p-value
snp10    3.8571 0.04953
snp4     2.5714 0.10881
snp5     1.1429 0.28505
snp8     1.0000 0.31731
snp6     0.6923 0.40538
\end{Soutput}
\end{Schunk}
\section{\emph{iTrio} class}
\begin{Schunk}
\begin{Sinput}
> (iTrio.obj <- iTrio(tg.ped.comp, lrr = geno.trio, baf = geno.trio))
\end{Sinput}
\begin{Soutput}
iTrio (storageMode: lockedEnvironment)
assayData: 10 features, 33 samples 
  element names: baf, lrr 
protocolData: none
phenoData: none
featureData
  featureNames: snp1 snp2 ... snp10 (10 total)
  fvarLabels: position chromosome isSnp
  fvarMetadata: labelDescription
experimentData: use 'experimentData(object)'
Annotation:  
genome:  hg19 
\end{Soutput}
\end{Schunk}
\end{document}
%% <<ids, echo = FALSE, eval = FALSE>>=
%% id <- offspringNames(tg.ped)
%% fid <- fatherNames(tg.ped)
%% mid <- motherNames(tg.ped)
%% names(fid) <- names(mid) <- id
%% c(length(unique(id)),length(unique(fid)),length(unique(mid)))
%% @
